PROTO lilbot [
    field SFString   robot_name         "lilbot"
    field SFVec3f    robot_translation  0.0 0.0 0.1
    field SFRotation robot_rotation     0.0 0.0 1.0 0.0
    field SFString   robot_controller   "<extern>"

	field SFVec3f	 mesh_scale  0.001 0.001 0.001
	field MFString	 mesh_body_url ["../meshes/body.obj"]
	field MFString	 mesh_wheel_url ["../meshes/wheel.obj"]
	field MFString   mesh_caster_ball_url ["../meshes/caster_ball.obj"]
]
{
    Robot {
        name IS robot_name
        translation IS robot_translation
        rotation IS robot_rotation
        controller IS robot_controller
        children [
            Transform {
                children [
                    Lidar {
                        translation 0 0 0.09
                        horizontalResolution 360
                        fieldOfView 6.28319
                        numberOfLayers 1
                        minRange 0.12
                        maxRange 8
                        type "rotating"
                        noise 0.0002
                        resolution 0.96
                        defaultFrequency 6
                        minFrequency 5
                        maxFrequency 8
                    }
                ]
            }
            BallJoint {
                jointParameters BallJointParameters {
                    anchor 0.0625 0 -0.007
                    staticFriction 0.5
                }
                jointParameters2 JointParameters {
                    axis 1 0 0
                    staticFriction 0.5
                }
                jointParameters3 JointParameters {
                    axis 0 1 0
                    staticFriction 0.5
                }
                endPoint Solid {
                    translation 0.0625 0 -0.007
                    children [
                        Transform {
                            scale IS mesh_scale
                            children [
                                DEF BALL Shape {
                                    appearance PBRAppearance { }
                                    geometry Mesh { url IS mesh_caster_ball_url }
                                }
                            ]
                        }
                    ]
                    name "caster_ball_front"
                    boundingObject Transform {
                        scale IS mesh_scale
                        children [ USE BALL ]
                    }
                    physics Physics { }
                }
            }
            BallJoint {
                jointParameters BallJointParameters {
                    anchor -0.0625 0 -0.007
                    staticFriction 0.5
                }
                jointParameters2 JointParameters {
                    axis 1 0 0
                    staticFriction 0.5
                }
                jointParameters3 JointParameters {
                    axis 0 1 0
                    staticFriction 0.5
                }
                endPoint Solid {
                    translation -0.0625 0 -0.007
                    children [
                        Transform {
                            scale IS mesh_scale
                            children [
                                DEF BALL Shape {
                                    appearance PBRAppearance { }
                                    geometry Mesh { url IS mesh_caster_ball_url }
                                }
                            ]
                        }
                    ]
                    boundingObject Transform {
                        scale IS mesh_scale
                        children [ USE BALL ]
                    }
                    physics Physics { }
                }
            }
            Transform {
                scale IS mesh_scale
                children [
                    DEF BODY Shape {
                        appearance PBRAppearance { metalness 0 }
                        geometry Mesh { url IS mesh_body_url }
                    }
                ]
            }
            HingeJoint {
                jointParameters HingeJointParameters {
                    axis 0 1 0
                    anchor 0 0.0925 0.0225
                    staticFriction 0.1
                }
                device [
                    PositionSensor {
                        name "encoder_wheel_left"
                        noise 0.001
                        resolution 0.00670421
                    }
                    RotationalMotor { name "motor_wheel_left" }
                ]
                endPoint Solid {
                    name "wheel_left"
                    translation 0 0.094 0.0225
                    rotation 0 0 1 3.139727936715174
                    children [
                        Transform {
                            scale IS mesh_scale
                            children [
                                Shape {
                                    appearance PBRAppearance {
                                        baseColor 0.1 0.1 0.5
                                        roughness 1
                                        metalness 0
                                    }
                                    geometry Mesh { url IS mesh_wheel_url }
                                }
                            ]
                        }
                    ]
                    boundingObject Transform {
                        translation 0 -0.0125 0
                        rotation 1 0 0 1.5708
                        children [
                            Shape {
                                geometry Cylinder {
                                    height 0.025
                                    radius 0.038
                                }
                            }
                        ]
                    }
                    physics Physics { }
                }
            }
            HingeJoint {
                jointParameters HingeJointParameters {
                    axis 0 1 0
                    anchor 0 -0.0925 0.0225
                    staticFriction 0.1
                }
                device [
                    PositionSensor {
                        name "encoder_wheel_right"
                        noise 0.001
                        resolution 0.00670421
                    }
                    RotationalMotor { name "motor_wheel_right" }
                ]
                endPoint Solid {
                    name "wheel_right"
                    translation 0 -0.094 0.0225
                    rotation 0 1 0 2.9964074639928517
                    children [
                        Transform {
                            scale IS mesh_scale
                            children [
                                DEF WHEEL Shape {
                                    appearance PBRAppearance {
                                        baseColor 0.1 0.1 0.5
                                        roughness 1
                                        metalness 0
                                    }
                                    geometry Mesh { url IS mesh_wheel_url }
                                }
                            ]
                        }
                    ]
                    
                    boundingObject Transform {
                        translation 0 -0.0125 0
                        rotation 1 0 0 1.5708
                        children [
                            Shape {
                                geometry Cylinder {
                                    height 0.025
                                    radius 0.038
                                }
                            }
                        ]
                    }
                    physics Physics { }
                }
            }
        ]
        boundingObject Transform {
            scale IS mesh_scale
            children [ USE BODY ]
        }
        physics Physics {
            density -1
            mass 0.911
            centerOfMass [-0.02 0.0 0.02 ]
        }
    }
}